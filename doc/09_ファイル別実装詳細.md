# 09. ファイル別実装詳細

## 9.1 Shared

### `src/shared/contracts.ts`

- Main / Preload / Renderer 共有の契約型定義
- 予定行、設定、ユーザー、認証結果、更新通知型を管理

## 9.2 Main Process

### `src/main/index.ts`

- Composition Root
- Window/Tray/アプリ終了制御
- サービス生成と依存注入
- ログインユーザー、設定、スケジューラ状態の保持

### `src/main/ipc/registerMainIpcHandlers.ts`

- IPC ハンドラ登録専用
- 認証、設定、取得 API の公開
- ログイン/ログアウト後の状態同期処理

### `src/main/services/calendarPublisher.ts`

- 予定取得処理の実行と Renderer 通知
- `calendar-updated` ペイロード生成
- ログアウト時の空データ配信

### `src/main/services/autoFetchScheduler.ts`

- 30秒周期の判定ループ管理
- 指定時刻/指定間隔の実行判定
- 実行済み状態のリセット制御

### `src/main/services/autoLaunch.ts`

- Windows パッケージ版での初回自動起動設定
- マーカーファイルによる一度きり実行制御

### `src/main/services/taskStore.ts`

- `lowdb` を使ったタスク保存
- ユーザー別 `tasks.json` 管理
- タスクCRUDと補完マスタ（projects/categories）管理
- ゲストセッションデータの削除処理

### `src/main/googleAuth.ts`

- OAuth 設定読み込み
- ブラウザ認証（ローカル HTTP コールバック）
- プロフィール取得 (`userinfo.get`)
- `current-user.json` / `user-profile.json` / `token.json` 管理
- `token.json` の暗号化保存（可能時）と互換読込
- カレンダー一覧 + イベント一覧取得
- 並列取得 + リトライ制御

### `src/main/appSettings.ts`

- 設定ファイルパス解決（ユーザー別/ゲスト）
- 設定値正規化
- 設定読み書き

## 9.3 Preload

### `src/preload/index.ts`

- `contextBridge` で `window.api` を公開
- Renderer から利用する IPC 呼び出しを集約

### `src/preload/index.d.ts`

- `window.api` の型宣言
- Renderer 補完と型安全を提供

## 9.4 Renderer

### `src/renderer/src/main.tsx`

- Renderer エントリーポイント
- `App` マウント

### `src/renderer/src/App.tsx`

- 画面全体の状態オーケストレーション
- 初期データ読込
- 同期処理
- 認証処理
- モーダル開閉
- 通知購読と UI 反映

### `src/renderer/src/hooks/useDateEditor.ts`

- 日付入力の状態・検証・フォーカス遷移
- 数字正規化、0補完、Enter 確定

### `src/renderer/src/lib/dateUtils.ts`

- 日付/時刻フォーマット
- 数字入力正規化

### `src/renderer/src/lib/settingsUtils.ts`

- 間隔入力（分/時間）と保存値（分）の変換

### `src/renderer/src/lib/taskTimeUtils.ts`

- 見積時刻計算（開始/終了/分）
- 実績ログ時間の分換算（秒切り捨て）
- 開始/停止時のログ整形

### `src/renderer/src/types/ui.ts`

- UI 固有型
- `@shared/contracts` の再エクスポート

### `src/renderer/src/components/DateSelector.tsx`

- 日付表示ボタンと入力パネル UI

### `src/renderer/src/components/DashboardTabs.tsx`

- 予定表/タスクのタブ UI

### `src/renderer/src/components/ScheduleTable.tsx`

- 予定表テーブル表示

### `src/renderer/src/components/TaskBoard.tsx`

- タスク登録フォーム
- タスク一覧表示
- ステータス変更と計測操作（開始/中断/停止/完了）

### `src/renderer/src/components/ProfileSection.tsx`

- ログインボタン、プロフィールボタン、メニュー表示

### `src/renderer/src/components/SettingsModal.tsx`

- 設定モーダル表示

### `src/renderer/src/components/LogoutConfirmModal.tsx`

- ログアウト確認モーダル表示

### `src/renderer/src/assets/main.css`

- ダッシュボード全体スタイル
- 上部レイアウト、テーブル、モーダル、レスポンシブ定義

## 9.5 設定ファイル

### `package.json`

- スクリプト定義（開発、型チェック、ビルド）
- 依存パッケージ定義

### `electron-builder.yml`

- 配布パッケージ設定
- プラットフォーム別出力設定
