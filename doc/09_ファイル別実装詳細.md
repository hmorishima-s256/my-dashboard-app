# 09. ファイル別実装詳細

## 9.1 Shared

### `src/shared/contracts.ts`

- 全層共有の契約型
- `Task.actual` に `suspendMinutes` / `suspendStartedAt` を定義

### なぜ

- IPC境界で型の二重管理を防ぎ、仕様変更時の破壊を最小化するため

## 9.2 Main

### `src/main/index.ts`

- Composition Root
- Window/Tray/終了動作を統合
- サービスを組み合わせてアプリ全体を起動

### `src/main/googleAuth.ts`

- OAuthフロー
- `userinfo.get()` によるプロフィール取得
- 全カレンダー予定取得（並列 + リトライ）
- ユーザー/トークン保存

### `src/main/appSettings.ts`

- ユーザー別/ゲスト設定の読込・保存
- 値正規化

### `src/main/services/calendarPublisher.ts`

- 予定取得と `calendar-updated` 通知配信

### `src/main/services/autoFetchScheduler.ts`

- 30秒周期で時刻/間隔の実行判定

### `src/main/services/autoLaunch.ts`

- Windows初回自動起動設定

### `src/main/services/taskStore.ts`

- lowdb CRUD
- ユーザー別 `tasks.json` 管理
- 旧データ互換の正規化（`suspendMinutes` 追加対応）
- 案件別候補（カテゴリ/タスク）を動的生成

### `src/main/ipc/registerMainIpcHandlers.ts`

- 機能別IPC登録の合成

### `src/main/ipc/handlers/*.ts`

- `calendarHandlers`: 予定同期IPC
- `settingsHandlers`: 設定IPC
- `taskHandlers`: タスクIPC
- `authHandlers`: 認証IPC
- `types.ts`: 依存契約型

## 9.3 Preload

### `src/preload/index.ts`

- `window.api` を安全公開

### `src/preload/index.d.ts`

- `window.api` の型定義

### なぜ

- RendererからMainへの許可済み操作だけを公開し、境界を固定するため

## 9.4 Renderer

### `src/renderer/src/App.tsx`

- 全体合成
- 日付シェブロン操作、同期、モーダル接続

### `src/renderer/src/hooks/useAuthController.ts`

- ログイン/ログアウト状態管理

### `src/renderer/src/hooks/useDashboardSettings.ts`

- 設定ドラフトと保存

### `src/renderer/src/hooks/useCalendarRows.ts`

- 予定行状態と通知購読

### `src/renderer/src/hooks/useDateEditor.ts`

- 日付入力の状態・検証・フォーカス制御
- 前日/翌日シフト関数

### `src/renderer/src/components/DateSelector.tsx`

- 日付ボタン、左右シェブロン、入力パネル

### `src/renderer/src/components/ScheduleTable.tsx`

- 予定表テーブル描画

### `src/renderer/src/components/TaskBoard.tsx`

- タスク一覧/操作
- 登録・詳細モーダル
- 実績の中断/再開ロジック連携

### `src/renderer/src/components/SettingsModal.tsx`

- 設定入力UI

### `src/renderer/src/components/ProfileSection.tsx`

- ログインUI / プロフィールメニュー

### `src/renderer/src/components/DashboardTabs.tsx`

- タブ切替UI

### `src/renderer/src/lib/dateUtils.ts`

- 日付整形と入力正規化

### `src/renderer/src/lib/settingsUtils.ts`

- 間隔入力の分変換

### `src/renderer/src/lib/taskTimeUtils.ts`

- 見積/実績時間計算
- 昼休憩控除
- 中断時間控除
- 開始/中断/再開/停止処理

### `src/renderer/src/assets/main.css`

- ダッシュボード全体スタイル
- モーダル、テーブル、状態色、レスポンシブ

## 9.5 設定ファイル

### `package.json`

- 開発/ビルド/テストスクリプト

### `electron-builder.yml`

- 配布設定
- Windows向け `signAndEditExecutable: false`

### なぜ

- ビルドの環境依存エラーを抑え、配布手順を安定化するため
