# 07. セットアップ運用手順

## 7.1 前提

- Node.js / npm が利用可能
- Google CloudでOAuthクライアント作成済み
- `credentials.json` をプロジェクトルートに配置済み

## 7.2 初期セットアップ

```bash
npm install
```

## 7.3 開発実行

```bash
npm run dev
```

型チェック:

```bash
npm run typecheck
```

テスト:

```bash
npm run test
```

## 7.4 ビルド

共通ビルド:

```bash
npm run build
```

OS別:

```bash
npm run build:win
npm run build:mac
npm run build:linux
```

Windowsでインストーラ不要の場合:

```bash
npm run build:unpack
```

### 補足（なぜこの運用か）

- `build:win` は署名編集で環境依存エラーが起きやすいため、設定で `signAndEditExecutable: false` を採用
- ローカル検証を優先する場合は `build:unpack` の方が安定しやすい

## 7.5 初回ログイン運用

1. アプリ起動
2. 右上 `Googleログイン`
3. ブラウザで認証/同意
4. ブラウザに完了ページ表示
5. アプリが前面に戻り、当日予定が同期される

## 7.6 日常運用

- 予定同期: 右上 `同期`
- 日付移動:
  - 日付右の `◀` / `▶` で前日/翌日
  - または日付入力パネルで直接指定
- タスク:
  - `タスク登録` で追加
  - 一覧から `詳細` で更新
  - `開始/中断/再開/停止/完了` で進捗更新
- 設定:
  - 左下歯車 -> 時刻/間隔/時間表示を設定 -> 保存

## 7.7 常駐と終了

- ウィンドウの `×` で確認ダイアログ
  - `バックグラウンド常駐`: トレイへ格納
  - `終了`: 完全終了

### なぜこの仕様か

- ユーザーの意図（最小化したいのか終了したいのか）が分かれるため、毎回明示的に選べるようにしている

## 7.8 Windows自動起動運用

- 条件:
  - Windows
  - パッケージ版
- 初回1回だけ `openAtLogin=true` を設定
- 再設定防止:
  - `_shared/auto-launch-initialized`
- 隠し起動:
  - `--hidden`

## 7.9 トラブルシュート

### ログインできない

- `credentials.json` の `redirect_uris` に `localhost` があるか確認
- OAuth同意画面の設定を確認

### 予定が取得できない

- ログイン状態を確認
- 対象日付に予定があるか確認
- 該当カレンダーの閲覧権限を確認

### 自動取得が動かない

- 設定保存済みか確認
- 時刻形式が `HH:mm` か確認
- 間隔が1以上か確認
- 未ログインでは実行されない点を確認

### `npm run build:win` で失敗する

- キャッシュ権限エラー時は以下を試す
  - ターミナルを管理者で実行
  - `%LOCALAPPDATA%\electron-builder\Cache` のクリア
- まずは `npm run build:unpack` で動作確認する
