# 10. テスト仕様

## 10.1 目的

- 回帰検知
- リファクタリングの安全網
- IPC契約の破壊防止

## 10.2 テスト方針（なぜこの方針か）

- 純粋関数はユニットテスト中心
- Mainは依存注入でI/Oを分離してテスト
- IPCは登録と副作用の境界を検証

理由:
- E2E未整備でも、主要ロジックを高速に検証可能にするため

## 10.3 使用ツール

- `vitest`
- コマンド:
  - `npm run test`
  - `npm run test:watch`

## 10.4 現在のテスト対象

### Renderer

- `tests/renderer/dateUtils.test.ts`
  - 日付整形、曜日表記、入力正規化
- `tests/renderer/settingsUtils.test.ts`
  - 間隔の分/時間変換
- `tests/renderer/taskTimeUtils.test.ts`
  - 見積計算、実績計算、昼休憩控除
  - 中断/再開、停止時の加算

### Main

- `tests/main/appSettings.test.ts`
  - 設定正規化、ユーザー別保存
- `tests/main/autoFetchScheduler.test.ts`
  - 時刻/間隔判定、未ログイン時非実行
- `tests/main/calendarPublisher.test.ts`
  - 通知配信、例外時挙動
- `tests/main/taskStore.test.ts`
  - CRUD、ゲストデータ削除
- `tests/main/registerMainIpcHandlers.test.ts`
  - 合成登録
- `tests/main/ipc/*.test.ts`
  - calendar/settings/task/auth ハンドラ

## 10.5 現在の基準値

- `12 test files / 46 tests` が `passed`
- `npm run typecheck` も通過必須

## 10.6 実行手順

```bash
npm install
npm run typecheck
npm run test
```

## 10.7 未カバー領域

- OAuthブラウザフローの実動作
- BrowserWindow/Tray を含む統合挙動
- RendererコンポーネントのUIテスト

## 10.8 今後の拡張方針

1. DateSelector/TaskBoardのコンポーネントテスト追加
2. Mainの統合テスト整備
3. 認証フローのモック統合テスト追加
