# 03. 機能仕様

## 3.1 Google 認証

### ログイン

- ボタン: `Googleログイン`
- 実行 API: `auth:login`
- 認可スコープ
  - `https://www.googleapis.com/auth/calendar.readonly`
  - `openid`
  - `https://www.googleapis.com/auth/userinfo.email`
  - `https://www.googleapis.com/auth/userinfo.profile`
- 成功時
  - ユーザー情報を保存
  - メイン画面を前面表示
  - 当日予定を自動取得

### ログアウト

- UI: プロフィールメニュー内 `ログアウト`
- 確認モーダルあり
- 実行 API: `auth:logout`
- 動作
  - `token.json` 削除
  - 現在ユーザー state を解除
  - 予定表示をクリア
  - 設定はゲスト設定へ切替

## 3.2 予定取得

### 手動同期

- ボタン: `同期`
- 実行 API: `get-calendar(targetDate?)`
- 未ログイン時は無効

### 取得対象

- `calendarList` で登録済み全カレンダーを取得
- 各カレンダーに対して指定日のイベント一覧を取得
- 1 日分範囲で検索
  - `timeMin`: 00:00:00
  - `timeMax`: 23:59:59

### 表示整形

- カレンダー名
  - `summaryOverride` → `summary` → `id` の順で採用
  - メール形式なら `@` 前を表示
- 件名
  - `summary` がなければ `(no title)`
- 日時
  - 終日予定: `1day`
  - 時刻予定: JST `HH:mm:ss` を開始・終了2行で表示

## 3.3 日付指定

- 上部左の日付表示をクリックで入力パネル開閉
- 入力形式: `yyyy / mm / dd`
- 入力制御
  - 全角数字は半角へ自動変換
  - 数字以外は除去
  - 桁不足は 0 補完
  - `yyyy` → `mm` → `dd` の順に自動フォーカス
  - `dd` で Enter は `OK` と同等
- バリデーション
  - 桁数不足
  - 月範囲外（01-12）
  - 日範囲外（01-31）
  - 実在しない日付（例: 2/31）
- エラー時
  - 入力枠を赤表示
  - インラインエラーメッセージ表示

## 3.4 タブ表示

- `予定表` タブ
  - 実データ表示
- `タスク` タブ
  - モック表示（選択日文字列ベース）

## 3.5 設定機能

- 起動トリガー: 左下歯車
- 設定項目
  - 自動取得時刻 (`HH:mm`、未設定可)
  - 自動取得間隔（分単位保存、UIは分/時間切替）
- ボタン
  - `閉じる`
  - `未設定にする`（時刻/間隔を null 保存）
  - `保存`

## 3.6 自動取得スケジューラ

- 判定周期: 30 秒
- 条件
  - 指定時刻: 1日1回のみ実行
  - 指定間隔: 前回実行から N 分経過で実行
- 両方設定時
  - いずれかの条件を満たした時点で実行

## 3.7 バックグラウンド常駐

- ウィンドウ `X` 押下時に選択ダイアログ表示
  - `バックグラウンド常駐`
  - `終了`
- 常駐時
  - ウィンドウ非表示
  - トレイから再表示可能
- 終了時
  - タイマー停止
  - トレイ破棄
  - アプリ終了

## 3.8 Windows 自動起動

- 対象: `win32` かつパッケージ版のみ
- 初回1回のみ `openAtLogin = true` を設定
- 再設定防止マーカー
  - `_shared/auto-launch-initialized`
- 自動起動引数
  - `--hidden`（起動時ウィンドウ非表示）

## 3.9 更新通知

- Main は予定取得後に `calendar-updated` を送信
- Renderer は購読して一覧/更新日時を更新
- 表示日付が今日以外のとき、自動更新通知は無視して表示保護
