# 06. データ保存仕様

## 6.1 保存ポリシー

- 外部 DB は使わずローカルファイルシステムのみを利用
- ユーザー共通データとユーザー別データを分離
- ログアウト時は `token.json` だけ削除し、設定やプロフィールは保持

## 6.2 ルートディレクトリ

Windows ユーザーのホーム直下:

```txt
C:\Users\<Windowsユーザー名>\my-dashboard-app\
```

実装定数:

- `APP_LOCAL_ROOT_PATH = path.join(os.homedir(), 'my-dashboard-app')`

## 6.3 ディレクトリ構成

```txt
my-dashboard-app/
  _shared/
    current-user.json
    settings.guest.json
    electron.svg
    auto-launch-initialized
  <url-encoded-email>/
    token.json
    user-profile.json
    settings.json
```

## 6.4 共通ファイル

### `current-user.json`

- 現在アクティブユーザーのポインタ

```json
{
  "email": "user@example.com"
}
```

### `settings.guest.json`

- 未ログイン時設定

### `electron.svg`

- 共有デフォルトアイコン（Main 側で必要時生成）

### `auto-launch-initialized`

- 自動起動設定を初回適用済みかのマーカー

## 6.5 ユーザー別ファイル

### `token.json`

- OAuth 認証情報
- ログアウトで削除対象

### `user-profile.json`

- ユーザー名、メール、アイコン URL

```json
{
  "name": "Taro",
  "email": "user@example.com",
  "iconUrl": "https://..."
}
```

### `settings.json`

- ユーザー別設定

```json
{
  "autoFetchTime": "08:30",
  "autoFetchIntervalMinutes": 60
}
```

## 6.6 設定値の正規化

- `autoFetchTime`
  - `HH:mm` のみ有効
  - 不正値は `null`
- `autoFetchIntervalMinutes`
  - 1以上の整数のみ有効
  - 不正値は `null`

## 6.7 既知の取り扱い注意

- `credentials.json` はリポジトリルートに存在し、OAuth クライアント情報を含む
- `token.json` は平文 JSON のため、配布運用時はアクセス権管理が必要
